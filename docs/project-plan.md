# ClipDock - iOS 外接存储视频迁移 App 项目进度文档（3 天冲刺版）

## 1. 项目周期与协作方式

### 1.1 周期
MVP 冲刺周期：3 天（连续开发 + 每模块闭环验证）。

### 1.2 人力协作（你 + 我）
1. 你：本地 Xcode 运行、真机验证、交互确认、权限与外设场景验证。
2. 我：方案落地、代码实现、模块自测、问题修复、回归清单维护。
3. 协作节奏：每个最小模块完成后立即联调并验收，不堆积到最后统一测试。

### 1.3 范围边界（3 天内）
仅覆盖 MVP 主链路：
1. 扫描视频并按日期排序。
2. 用户手动选择要迁移的视频。
3. 迁移到外接存储。
4. 校验成功后删除源视频。
5. 展示结果与失败原因（轻量版）。

## 2. 最小模块闭环工时预估（开发 + 验证）

说明：
1. 单位为小时（h），每项包含编码、联调、最小验证。
2. 按串行执行估算，总计约 `22h`，另预留 `2h` 机动缓冲，总 `24h`。

1. `M0 工程骨架与基础配置`：`1.5h`
   - 开发：1.0h（工程、目录、日志、错误码）
   - 验证：0.5h（可编译、可运行、日志可输出）
2. `M1 权限模块（PhotoKit）`：`1.5h`
   - 开发：1.0h（授权请求、状态处理）
   - 验证：0.5h（首次授权/拒绝/二次授权）
3. `M2 外接目录选择与 bookmark`：`2.5h`
   - 开发：1.5h（目录选择、bookmark 存储/恢复）
   - 验证：1.0h（断开重连、权限失效提示）
4. `M3 视频扫描与日期排序`：`3.0h`
   - 开发：2.0h（读取视频、按日期降序）
   - 验证：1.0h（空库/少量/多条排序正确）
5. `M4 手动选择模块`：`2.0h`
   - 开发：1.2h（多选/全选/统计）
   - 验证：0.8h（选择状态一致、统计准确）
6. `M5 迁移执行器（复制到外接盘）`：`4.0h`
   - 开发：3.0h（逐条迁移、进度、错误回传）
   - 验证：1.0h（mov/mp4 样本迁移成功）
7. `M6 校验模块`：`2.0h`
   - 开发：1.2h（存在性/大小/可读性）
   - 验证：0.8h（成功与失败样本判定）
8. `M7 删除模块（仅成功项）`：`2.0h`
   - 开发：1.2h（二次确认 + performChanges 删除）
   - 验证：0.8h（删除后相册不可见）
9. `M8 结果页与任务记录（轻量）`：`2.0h`
   - 开发：1.2h（成功/失败统计、失败原因）
   - 验证：0.8h（强退重进后可看到最近结果）
10. `M9 端到端联调与异常场景`：`1.5h`
   - 开发：0.5h（修补流程断点）
   - 验证：1.0h（拔盘/权限变化/目标目录不可写）

## 3. 3 天排期（日计划）

### Day 1（目标：可扫描+可选择）
1. 完成 `M0 + M1 + M2`。
2. 完成 `M3`。
3. 启动 `M4`，做到可多选。

验收口径：
1. 可稳定列出视频并按日期排序。
2. 可选择外接目录并恢复访问权限。
3. 可手动勾选待迁移视频。

### Day 2（目标：可迁移+可校验）
1. 完成 `M4` 收尾。
2. 完成 `M5 + M6`。
3. 联调迁移主流程与进度展示。

验收口径：
1. 选中视频可迁移到外接盘。
2. 每条视频有明确成功/失败状态。
3. 校验结果可用于后续删除决策。

### Day 3（目标：可删除+可交付）
1. 完成 `M7 + M8 + M9`。
2. 执行端到端回归与异常回归。
3. 输出冲刺结果与后续迭代清单。

验收口径：
1. 扫描 -> 选择 -> 迁移 -> 校验 -> 删除全链路可跑通。
2. 异常场景可预期失败并给出明确提示。
3. 可演示的 MVP 版本可交付。

## 4. 每模块闭环验证清单（统一模板）

每个模块都按以下流程闭环：
1. 开发完成并自测通过（我）。
2. 你在真机/外设场景复测一次。
3. 记录问题并立即修复。
4. 修复后回归当前模块 + 上一模块关键路径。
5. 更新“已完成模块清单”后进入下一模块。

## 5. 风险与 3 天内应对

1. 外接盘兼容不稳定：
   - 方案：优先锁定 1-2 个稳定设备完成 MVP 验收。
2. 大文件迁移耗时超预期：
   - 方案：Day 2 先确保功能正确，性能优化放在 Day 3 机动时间。
3. 删除权限/行为差异：
   - 方案：只对“校验成功”项开放删除，失败项不删。

## 6. 冲刺输出物

1. 可运行 MVP 工程（主链路可演示）。
2. 模块级验证记录（按 M0-M9）。
3. 已知问题清单与下一轮迭代计划。

## 7. 阶段性进展记录（Progress Log）

### 2026-02-12（Day 1）

完成情况：
1. `M0 工程骨架与基础配置`：完成
2. `M1 权限模块（PhotoKit）`：完成（真机点击 `Grant Access` 可正常弹出权限框）
3. `M2 外接目录选择与 bookmark`：完成（目录选择、写入探针校验）
4. `M3 视频扫描与日期排序`：完成（列表展示按日期倒序）

遇到的问题与解决（摘要）：
1. iOS 编译失败：`withSecurityScope` 相关 bookmark 选项在 iOS 不可用，已改为 iOS 使用 `.minimalBookmark`。
2. 真机点击 `Grant Access` 闪退：打包 `Info.plist` 缺少 Photos 权限用途说明 key，已补齐 `NSPhotoLibraryUsageDescription` / `NSPhotoLibraryAddUsageDescription`。

证据（截图）：
1. 待补：ClipDock 首页截图（权限状态、外接目录、视频扫描结果）。
   - 计划路径：`docs/assets/clipdock-progress-2026-02-12.png`

下一步（Day 1 余量 / Day 2）：
1. `M4 手动选择模块`：多选/全选/统计
2. `M5 迁移执行器（复制到外接盘）`：逐条迁移、进度、错误回传
